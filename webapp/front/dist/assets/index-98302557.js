import{u as a,r as x,s as y,b as o,F as w,j as s,a as D,e as k,f as L,g as M,h as P,d as j,i as G,k as I}from"./index-2cc049ce.js";import{u as A,C as O,H as E}from"./index-312ce64b.js";import{T as b,C as _,g as T,e as S,O as f,S as C,V as $,f as F,h as H,N as J,j as U}from"./my-sites-85cae127.js";const B="/assets/voting-list-of-creatives-aa396a27.svg",R=()=>{const l=a(e=>e.app.ADsGTVP);a(e=>e.app.address),a(e=>e.app.siteList),a(e=>e.app.isAdvertiser);const r=a(e=>e.app.daoContract),i=a(e=>e.app.endDate),c=e=>async(n,N)=>{Math.floor(new Date().getTime()/1e3)+i*60;try{const g=await T();await(await S(r).vote(Number(e),n,N,{gasLimit:5e6,gasPrice:g})).wait(),alert("Vote Successfully")}catch(g){console.log("Err: ",g)}},p=A(),d=a(e=>e.app.advertiserList),m=a(e=>e.app.contractAdvertiserList),u=e=>e===1?"passed":e===2?"rejected":"process";return x.useEffect(()=>{fetch("/api/creatives").then(e=>{e.text().then(n=>p(y(JSON.parse(n))))}).catch(()=>alert("something went wrong"))},[]),o(w,{children:[s(b,{className:"my-8",src:B,alt:"my creative"}),s("div",{className:"flex flex-col gap-12",children:m.map((e,n)=>s(_,{id:e.id!==void 0?e.id.toNumber().toString():e.id,createdAt:new Date(e.createdAt!==void 0?e.createdAt.toNumber()*1e3:0),expires:new Date(e.endAt!==void 0?e.endAt.toNumber()*1e3:0),link:e.siteUrl,image:d.length>n?d[n].img:"image",status:d.length>n?u(d[n].status):"process",ok:e.agreeVoteAmount!==void 0?e.agreeVoteAmount.toNumber():0,ng:e.rejectVoteAmount!==void 0?e.rejectVoteAmount.toNumber():0,maxVp:l,onVote:c(e.id!==void 0?e.id.toNumber().toString():e.id)},e.id!==void 0?e.id.toNumber():e.id))})]})},W="/assets/gt-b4539d83.svg",q="/assets/publisher-overview-7c397cd6.svg",z=()=>{const l=a(e=>e.app.MeGTVP),r=a(e=>e.app.rewardMeAmount),i=x.useMemo(()=>r.toLocaleString(),[r]),c=a(e=>e.app.stakingMeTokenBalance),p=x.useMemo(()=>c.toLocaleString(),[c]),d=e=>{alert(`stake: ${e}`)},m=a(e=>e.app.MeGTVP),u=a(e=>e.app.MeGTVPTime);return o(w,{children:[s(b,{className:"my-8",src:q,alt:"advertiser overview"}),o("div",{className:"flex gap-12",children:[s(f,{className:"h-48 flex-1",title:"MeGT",icon:W,children:s("p",{className:"text-48-bold text-neutral-10",children:i})}),s(f,{className:"h-48 flex-1",type:"publisher",title:"Staked MeGT",icon:C,onStake:d,maxVp:l,children:s("p",{className:"text-48-bold text-neutral-10",children:p})}),s(f,{className:"h-48 flex-1",title:"Voting Power (AD)",icon:$,children:o("div",{children:[s("p",{className:"text-48-bold text-neutral-10 inline",children:`${m}`}),s("p",{className:"text-28-semi text-neutral-40 inline",children:" / 100 VP"})]})}),s(f,{className:"h-48 flex-1",title:"VP Regen Speed",icon:F,children:o("div",{children:[s("p",{className:"text-48-bold text-neutral-10 inline",children:`${u}`}),s("p",{className:"text-28-semi text-neutral-40 inline",children:" VP / day"})]})})]})]})},K=()=>{const l=a(t=>t.app.MeGTVP),[r,i]=x.useState(!1),c=()=>i(!0),p=()=>i(!1),d=a(t=>t.app.address),m=a(t=>t.app.siteList);a(t=>t.app.isAdvertiser);const u=a(t=>t.app.daoContract),e=a(t=>t.app.endDate),n=a(t=>t.app.contractSiteList),N=async t=>{const h=Math.floor(new Date().getTime()/1e3)+e*60;try{await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.length+1,wallet_address:d,url:t})});const v=await T();await(await S(u).createContent(!1,h,t,{gasLimit:5e6,gasPrice:v})).wait(),alert("Create Successfully")}catch(v){console.log("Err: ",v)}},g=A();D.useEffect(()=>{fetch("/api/sites").then(t=>{t.text().then(h=>g(k(Array(h))))}).catch(()=>alert("something went wrong"))},[]);const V=t=>t===1?"passed":t===2?"rejected":"process";return o(w,{children:[o("div",{className:"flex justify-between",children:[s(b,{className:"my-8",src:H,alt:"voting list of sites"}),s("div",{className:"flex items-center",children:s(J,{onClick:c,isOpen:r,onClose:p,onCreate:N,children:"NEW SITE"})})]}),s("div",{className:"flex flex-col gap-12",children:n.map((t,h)=>s(U,{id:t.id!==void 0?t.id.toNumber().toString():t.id,url:t.siteUrl,createdAt:new Date(t.createdAt!==void 0?t.createdAt.toNumber()*1e3:0),status:m.length>h?V(m[h].status):"process",expires:new Date(t.endAt!==void 0?t.endAt.toNumber()*1e3:0),ok:t.agreeVoteAmount!==void 0?t.agreeVoteAmount.toNumber():0,ng:t.rejectVoteAmount!==void 0?t.rejectVoteAmount.toNumber():0,maxVp:l},t.id!==void 0?t.id.toNumber():t.id))})]})},ee=()=>{const l=a(p=>p.app.address),r=L(),i=A();return o(O,{children:[s(E,{address:l,current:"publisher",onDisconnect:()=>{r("/"),i(M(!0)),i(P(!1)),i(j(!1)),i(G(!1)),i(I(""))}}),s(z,{}),o("div",{className:"flex gap-12",children:[s("div",{className:"flex-[2_1_0%]",children:s(R,{})}),s("div",{className:"flex-[3_1_0%]",children:s(K,{})})]})]})};export{ee as Publisher};
